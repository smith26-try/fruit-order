<!DOCTYPE html>

<html lang="th">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Fruit Order App</title>
<style>
    :root{
      --green:#1b7f46;
      --green2:#67b57f;
      --bg:#f3f4f6;
      --card:#79a88c;
      --ink:#14221a;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);margin:0;padding:16px 16px 96px}
    h1{margin:0 0 10px;font-size:20px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
    .box{background:#e3f0e7;border-radius:14px;padding:14px}
    .input{width:100%;padding:12px 14px;border:1px solid #cfe1d6;border-radius:12px;font-size:16px;background:#fff}
    .pill{padding:12px 16px;border-radius:999px;background:var(--green);color:#fff;font-weight:700;text-align:center;display:inline-block;border:none;cursor:pointer}
    .suggest{position:relative}
    .suggest-list{position:absolute;z-index:20;top:100%;left:0;right:0;background:#fff;border:1px solid #d1d5db;border-radius:10px;max-height:220px;overflow:auto;box-shadow:0 8px 24px rgba(0,0,0,.08)}
    .suggest-item{padding:10px 12px;cursor:pointer}
    .suggest-item:hover{background:#f3f4f6}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin:18px 0}
    .card{background:var(--card);border-radius:22px;padding:22px;text-align:center;font-size:22px;color:var(--ink);font-weight:800;cursor:pointer;user-select:none}
    .footer{position:fixed;left:0;right:0;bottom:0;background:#e5e5e5;padding:14px 16px;display:flex;gap:14px;justify-content:center;box-shadow:0 -6px 16px rgba(0,0,0,.08)}
    .btn{border:none;border-radius:18px;padding:14px 20px;font-size:18px;font-weight:700;cursor:pointer}
    .btn-primary{background:var(--green2);color:#0b381f}
    .btn-danger{background:#e45a52;color:#fff}
    .hint{color:#9ca3af}
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.3);display:none;align-items:center;justify-content:center;z-index:50}
    .modal{background:#fff;border-radius:16px;max-width:680px;width:94%;padding:16px 16px 12px}
    .modal pre{white-space:pre-wrap;background:#f7f7f7;border:1px solid #e5e7eb;border-radius:10px;padding:10px;max-height:50vh;overflow:auto}
    .modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}
    .menu-grid{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center}
    @media (max-width:760px){ .grid{grid-template-columns:repeat(2,1fr)} }
    .badge{position:fixed;top:8px;right:12px;font-size:14px;font-weight:bold;color:#555}
  </style>
<!-- iOS UI fix v1.9.1 -->
<style>
  /* iOS-like clean spacing and readable controls */
  :root{
    --ios-bg:#f5f5f7;
    --ios-border:#E5E7EB;
    --ios-fg:#111827;
    --ios-muted:#6B7280;
    --ios-radius:14px;
  }
  /* Page background stays subtle */
  body{ background: var(--ios-bg); }
  /* Group wrappers: stack label chip above input */
  .date-group, .date-row, .date-section{
    display:flex; flex-direction:column; gap:8px;
  }

  /* Force any '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà' badge/button to stop overlapping */
  .label-chip, .chip, .badge, .tag, #btnDate, .btn-date{
    position: static !important;
    display:inline-flex;
    align-items:center;
    height:28px;
    padding:0 12px;
    background:#16a34a;
    color:#fff;
    font-weight:600;
    border-radius:9999px;
    width: fit-content;
    box-shadow: none;
    margin: 0 0 4px 0;
  }

  /* Make native date input look consistent with iOS fields */
  input[type="date"].input, #dateHidden.input, input[type="date"]#dateHidden{
    width:100%;
    height:48px;
    border:1px solid var(--ios-border);
    border-radius: var(--ios-radius);
    padding: 10px 14px;
    background:#fff;
    color: var(--ios-fg);
    font-size:16px;
    line-height:1.2;
    -webkit-appearance: none;
    appearance: none;
    box-sizing: border-box;
  }

  /* Calendar icon alignment (Safari/iOS) */
  input[type="date"]::-webkit-date-and-time-value { min-height: 28px; }
  input[type="date"]::-webkit-datetime-edit { padding: 4px 0; }
  input[type="date"]::-webkit-calendar-picker-indicator { margin-right: 6px; }

  /* The formatted date text below the input */
  #dateText, .date-text{
    margin-top:6px;
    color: var(--ios-fg);
    font-weight:600;
    letter-spacing: .2px;
  }

  /* Prevent any absolute layout from previous styles in the date row */
  .date-row * { top:auto !important; left:auto !important; right:auto !important; }

  /* Container breathing room if there is a narrow header bar */
  .container, .wrap, .content { padding-top: 16px; }

  /* Keep input focus neat (iOS style) */
  input[type="date"].input:focus, #dateHidden.input:focus{
    outline: none;
    box-shadow: 0 0 0 3px rgba(59,130,246,.25);
    border-color: #93C5FD;
  }

  /* Reduce oversized border radii from previous styles */
  .input{ border-radius: var(--ios-radius) !important; }
</style>
<style>
  /* Extra spacing for date section */
  .date-group, .date-row, .date-section{
    gap:14px !important;
    margin-bottom: 16px;
  }
  #dateText{ margin-top:10px !important; }
  /* Placeholder for date input */
  
</style>

<!-- iOS Green Theming Overrides v1.9.1 -->
<style>
  :root{
    --g0:#0E7C44;           /* primary green (dark) */
    --g1:#11A05A;           /* primary green */
    --g2:#B9E7CE;           /* mint highlight */
    --ink:#111827;          /* text */
    --muted:#6B7280;        /* secondary text */
    --bg:#F5F7F6;           /* app bg */
    --card:#FFFFFF;         /* surfaces */
    --radius-lg: 22px;
    --radius-md: 14px;
  }
  html,body{background:var(--bg); color:var(--ink)}
  body{padding:20px 16px 110px;}

  /* Header title like iOS */
  h1{
    font-size:28px;
    font-weight:800;
    letter-spacing:.2px;
    margin:4px 0 16px;
  }

  /* Date row */
  #btnDate{
    background:linear-gradient(180deg, var(--g1), var(--g0));
    padding:10px 14px;
    border-radius:999px;
    box-shadow: 0 2px 8px rgba(16,120,70,.28);
  }
  #dateHidden.input{
    height:52px;
    border-radius:16px;
    border:1px solid #E5E7EB;
    background:#fff;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
  }

  /* Customer box as soft card */
  .box{
    background: var(--card);
    border-radius: var(--radius-lg);
    padding:18px;
    border:1px solid #E6EBE8;
    box-shadow: 0 6px 24px rgba(15, 58, 34, 0.06);
  }
  .row{ gap:14px; margin-bottom:14px; grid-template-columns: 1fr 1fr; }
  .input{
    height:48px;
    border-radius: 14px;
    border:1px solid #E5E7EB;
    background:#fff;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.7);
    font-size:16px;
  }
  .input::placeholder{ color:#9CA3AF; }

  /* Category grid cards */
  .grid{
    grid-template-columns: repeat(2, 1fr);
    gap:14px;
    margin:18px 0 20px;
  }
  @media (min-width:760px){
    .grid{ grid-template-columns: repeat(3, 1fr); }
  }
  .card{
    background: radial-gradient(120% 140% at 0% 0%, var(--g2) 0%, #FFFFFF 55%);
    border-radius: 20px;
    padding:18px;
    font-size:18px;
    color:#0b381f;
    font-weight:800;
    border:1px solid #E6EBE8;
    box-shadow: 0 10px 24px rgba(28,105,69,.08);
    transition: transform .08s ease, box-shadow .2s ease;
  }
  .card:active{ transform: scale(.98); }
  .card:hover{ box-shadow: 0 12px 28px rgba(28,105,69,.12); }

  /* Footer actions (bottom bar) */
  .footer{
    background: rgba(255,255,255,.8);
    backdrop-filter: saturate(180%) blur(12px);
    border-top: 1px solid #E6EBE8;
    padding: 12px 16px;
    gap:12px;
  }
  .btn{
    border-radius: 14px;
    padding: 12px 18px;
    font-size:16px;
    font-weight:700;
  }
  .btn-primary{
    background: linear-gradient(180deg, var(--g1), var(--g0));
    color:#fff;
    box-shadow: 0 6px 18px rgba(16,120,70,.25);
  }
  .btn-danger{
    background:#ef4444;
    color:#fff;
  }

  /* Modal sheet */
  .modal-backdrop{ background: rgba(0,0,0,.35); }
  .modal{
    border-radius: 22px;
    border:1px solid #E6EBE8;
    box-shadow: 0 18px 40px rgba(0,0,0,.18);
    padding: 16px 16px 14px;
  }
  .modal h3{
    font-size:18px;
    font-weight:800;
  }
  .modal pre{
    background:#FBFBFC;
    border:1px solid #E8ECE9;
    border-radius:14px;
  }
  .modal-actions .btn{ min-width: 96px; }

  /* Menu panel grid: name | qty | sum */
  .menu-grid{
    grid-template-columns: 1fr 96px 80px;
    gap:10px;
  }
  .menu-grid .input{ height:40px; }

  /* Version badge to thin gray */
  .badge{
    background: transparent;
    color:#9CA3AF;
    font-weight:600;
    right: 14px;
  }
</style>


<!-- Button prominence adjustments v1.9.2 -->
<style>
  .btn{
    border-radius: 14px;
    padding: 14px 20px;
    font-size:17px;
    font-weight:700;
    transition: transform .08s ease, box-shadow .18s ease;
  }
  .btn:active{ transform: scale(.97); }

  .btn-primary{
    background: linear-gradient(180deg, #22c55e, #166534);
    color:#fff;
    box-shadow: 0 4px 14px rgba(22,101,52,.35);
    border:none;
  }
  .btn-primary:hover{
    box-shadow: 0 6px 18px rgba(22,101,52,.4);
  }

  .btn-danger{
    background: linear-gradient(180deg, #ef4444, #b91c1c);
    color:#fff;
    box-shadow: 0 4px 14px rgba(185,28,28,.35);
  }
  .btn-danger:hover{
    box-shadow: 0 6px 18px rgba(185,28,28,.4);
  }

  .btn-secondary{
    background:#fff;
    border:1px solid #d1d5db;
    color:#374151;
  }
</style>


<!-- Fresh Green UI pass v1.9.3 -->
<style>
  :root{
    --ff-g1:#34d399;   /* mint */
    --ff-g2:#10b981;   /* green */
    --ff-g3:#059669;   /* deep green */
    --ff-ink:#0b1f16;
    --ff-muted:#6b7280;
    --ff-border:#e5e7eb;
    --ff-bg:#0a1e16;   /* deep background to make gradient pop */
  }
  html,body{ color:var(--ff-ink); }
  body{
    background: linear-gradient(180deg, rgba(10,30,22,0.28), rgba(10,30,22,0.12)) no-repeat fixed, #f5f7f6;
  }
  /* Top gradient header band */
  body::before{
    content:"";
    position:fixed;
    top:0;left:0;right:0;height:260px;
    background: linear-gradient(180deg, var(--ff-g1), var(--ff-g2) 48%, var(--ff-g3));
    z-index:-1;
  }
  /* Title on gradient */
  h1{
    color:#ffffff;
    text-shadow: 0 2px 10px rgba(0,0,0,.18);
    margin:6px 0 12px;
    font-size:28px;font-weight:800;
  }
  /* Date pills on gradient */
  #btnDate{
    background:#ffffff;
    color:#065f46;
    box-shadow: 0 6px 22px rgba(0,0,0,.12);
  }
  #dateHidden.input{
    border:1px solid rgba(255,255,255,.7);
    background: #ffffff;
    box-shadow: 0 8px 26px rgba(0,0,0,.10);
  }

  /* Soft white cards like reference */
  .box{
    background:#ffffff;
    border:1px solid var(--ff-border);
    border-radius:22px;
    padding:18px;
    box-shadow: 0 14px 30px rgba(6,95,70,.10);
    margin-top:8px;
  }
  .row{ gap:12px; }
  .input{
    background:#ffffff;
    border:1px solid var(--ff-border);
    border-radius:14px;
    height:48px;
  }
  .input::placeholder{ color:#9ca3af; }

  /* Category cards: light gradient tiles with icon bubble */
  .grid{
    grid-template-columns: repeat(2, 1fr);
    gap:14px;
    margin:16px 0 18px;
  }
  @media (min-width:760px){ .grid{ grid-template-columns: repeat(3, 1fr);} }
  .card{
    position:relative;
    background: linear-gradient(180deg, #ffffff, #f1fff8 55%);
    border:1px solid var(--ff-border);
    color:#0b381f;
    border-radius:20px;
    padding:18px 18px 16px;
    font-weight:800;
    font-size:18px;
    box-shadow: 0 12px 26px rgba(6,95,70,.10);
    overflow:hidden;
  }
  .card::after{
    /* subtle blob */
    content:"";
    position:absolute; right:-18px; bottom:-18px; width:98px; height:98px;
    background: radial-gradient(ellipse at center, rgba(16,185,129,.25), rgba(16,185,129,0));
    border-radius:50%;
  }

  /* Bottom action bar more obvious */
  .footer{
    background: rgba(255,255,255,.95);
    backdrop-filter: blur(10px);
    border-top:1px solid var(--ff-border);
    box-shadow: 0 -12px 24px rgba(0,0,0,.06);
    padding:12px 16px;
    gap:12px;
  }
  .btn{
    border-radius:16px;
    padding:14px 20px;
    font-size:17px;font-weight:800;
    transition:transform .08s ease, box-shadow .2s ease;
  }
  .btn:active{ transform:scale(.97); }
  .btn-primary{
    background: linear-gradient(180deg, var(--ff-g2), var(--ff-g3));
    color:#fff;
    box-shadow: 0 8px 22px rgba(5,150,105,.35);
    border:none;
  }
  .btn-danger{
    background: linear-gradient(180deg, #f87171, #dc2626);
    color:#fff;
    box-shadow: 0 8px 22px rgba(220,38,38,.28);
  }
  .btn:not(.btn-primary):not(.btn-danger){
    background:#ffffff;
    color:#374151;
    border:1px solid #d1d5db;
  }

  /* Modal sheet */
  .modal{
    border-radius:22px;
    border:1px solid var(--ff-border);
    box-shadow: 0 24px 56px rgba(0,0,0,.22);
  }
  .modal h3{ font-weight:800; }
  .modal pre{
    background:#fbfbfd;border:1px solid #e5e7eb;border-radius:14px;
  }

  /* Menu grid: clearer columns */
  .menu-grid{ grid-template-columns: 1fr 100px 90px; gap:10px; }
  .menu-grid .input{ height:40px; }
  .menu-grid div[style*="font-weight: 700"]{ color:#065f46; }
  /* Version badge */
  .badge{ color:#E5E7EB; }
</style>


<style>
  body{
    background: #064e3b;
  }
  body::before{display:none!important;}
  .box, .card, .footer, .modal{background:#ffffff;}
</style>


<style>
  #modalWrap .modal{
    background: rgba(255,255,255,0.5);
    backdrop-filter: blur(16px) saturate(180%);
    -webkit-backdrop-filter: blur(16px) saturate(180%);
    border: 1px solid rgba(255,255,255,0.4);
    box-shadow: 0 8px 32px rgba(0,0,0,0.25);
  }
</style>


<style>
  /* Rounded top corners for the bottom action bar */
  .footer{
    border-top-left-radius: 24px !important;
    border-top-right-radius: 24px !important;
    overflow: hidden;
  }
</style>

</head>
<body>
<div class="badge">Version Better UI 1.9.3</div>
<h1>Fruit Order</h1>
<!-- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà -->
<div style="margin-bottom:14px">
<button class="pill" id="btnDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</button>
<input class="input" id="dateHidden" placeholder="DD/MM/YYYY" type="date"/>
</div>
<!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ -->
<div class="box">
<div class="row">
<div class="suggest">
<input autocomplete="off" class="input" id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠">
<div class="suggest-list" id="nameList" style="display:none"></div>
</input></div>
<div class="suggest">
<!-- ‡πÅ‡∏ö‡∏ö permissive: ‡πÑ‡∏°‡πà‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ï‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå -->
<input autocomplete="off" class="input" id="phone" maxlength="10" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" type="text"/>
<div class="suggest-list" id="phoneList" style="display:none"></div>
</div>
</div>
<div class="row">
<input class="input" id="address" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á"/>
<!-- ‡πÅ‡∏ö‡∏ö permissive: ‡πÑ‡∏°‡πà‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ï‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå -->
<input autocomplete="off" class="input" id="shipping" maxlength="6" placeholder="‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á" type="text"/>
</div>
<div class="row">
<input class="input" id="note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏"/>
<div></div>
</div>
</div>
<!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
<div class="grid">
<div class="card" onclick="openMenu('‡∏ù‡∏£‡∏±‡πà‡∏á')">‡∏ù‡∏£‡∏±‡πà‡∏á</div>
<div class="card" onclick="openMenu('‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á')">‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á</div>
<div class="card" onclick="openMenu('‡∏™‡πâ‡∏°')">‡∏™‡πâ‡∏°</div>
<div class="card" onclick="openMenu('‡∏Å‡∏£‡∏∞‡∏ó‡πâ‡∏≠‡∏ô')">‡∏Å‡∏£‡∏∞‡∏ó‡πâ‡∏≠‡∏ô</div>
<div class="card" onclick="openMenu('‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏£‡∏ß‡∏°')">‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏£‡∏ß‡∏°</div>

<div class="card" onclick="openMenu('‡πÄ‡∏£‡∏ó‡∏™‡πà‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©')">‡πÄ‡∏£‡∏ó‡∏™‡πà‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©</div><div class="card" onclick="openMenu('‡∏≠‡∏∑‡πà‡∏ô ‡πÜ')" style="grid-column:2/3">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</div>
</div>
<div class="footer">
<button class="btn btn-primary" onclick="summarize()">‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
<button class="btn btn-danger" onclick="clearAll()">‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
</div>
<!-- Modal Summary -->
<div class="modal-backdrop" id="modalWrap">
<div class="modal">
<h3 style="margin:0 0 8px">‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h3>
<pre id="summaryText"></pre>
<div class="modal-actions">
<button class="btn" onclick="copySummary()">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
<button class="btn btn-primary" onclick="printSummary()">‡∏û‡∏¥‡∏°‡∏û‡πå</button>
<button class="btn btn-danger" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
</div>
</div>
</div>
<!-- Modal Menu (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤) -->
<div class="modal-backdrop" id="menuWrap">
<div class="modal">
<h3 id="menuTitle" style="margin:0 0 8px">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
<div class="menu-grid" id="menuBody"></div>
<div class="modal-actions" style="margin-top:12px">
<button class="btn" id="btnMenuBack">‡∏Å‡∏•‡∏±‡∏ö</button>
<button class="btn btn-danger" id="btnMenuDelete">‡∏•‡∏ö</button>
<button class="btn btn-primary" id="btnMenuConfirm">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
</div>
</div>
</div>
<script>
/*** ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL ‡∏Ç‡∏≠‡∏á Apps Script Web App ***/
const GAS_BASE = 'https://script.google.com/macros/s/AKfycbx0UDI3YS2xRExAAEaBpOm8M1SkbWC_2q84f4HLlEX8k4gW_yy5EQGVq1e2v2lN4oAJAA/exec';
const GAS_SEARCH = (q) => `${GAS_BASE}?q=${encodeURIComponent(q)}`;  // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏µ‡∏¢‡πå ?q= ‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏ö‡∏≠‡∏£‡πå

/* ====== ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (DD/MM/YYYY) ====== */
const btnDate = document.getElementById('btnDate');
const dateHidden = document.getElementById('dateHidden');
const toDDMMYYYY = d => {
  const pad = n => String(n).padStart(2,'0');
  return `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()}`;
};
(function setToday(){
  // Do not auto-fill the date, placeholder handles display
}());
btnDate.addEventListener('click', ()=> dateHidden.showPicker ? dateHidden.showPicker() : dateHidden.focus());
dateHidden.addEventListener('change', ()=> dateText.textContent = toDDMMYYYY(new Date(dateHidden.value)));

/* ====== ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á DOM ‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï ====== */
const nameEl = document.getElementById('name');
const phone = document.getElementById('phone');
const shipping = document.getElementById('shipping');
const nameList = document.getElementById('nameList');
const phoneList = document.getElementById('phoneList');
const address = document.getElementById('address');
const note = document.getElementById('note');

/* ====== ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡πÅ‡∏ö‡∏ö v1.3 ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£ + cache) ====== */
let debounceT;
const debounce = (fn,ms)=> (...a)=>{ clearTimeout(debounceT); debounceT=setTimeout(()=>fn(...a),ms); };

const suggestCache = new Map(); // ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏¥‡∏á API
async function fetchSuggest(q){
  if(!q || q.length < 2) return [];
  if(suggestCache.has(q)) return suggestCache.get(q);
  try{
    const res = await fetch(GAS_SEARCH(q));
    if(!res.ok) return [];
    const js = await res.json();
    if(js && js.ok && Array.isArray(js.suggestions)) {
      suggestCache.set(q, js.suggestions);
      return js.suggestions;
    }
    if(Array.isArray(js)) return js; // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏Å‡πà‡∏≤
    return [];
  }catch(err){
    console.error('fetchSuggest error', err);
    return [];
  }
}

function showList(anchor,list,data,fill){
  if(!data.length){
    list.innerHTML = `
      <div class="suggest-item" style="color:#666">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
      <div class="suggest-item" style="color:#0b381f;font-weight:700">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</div>`;
    list.style.display='block';
    list.onclick = (e)=>{
      if(e.target.closest('.suggest-item') && e.target.textContent.includes('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤')) addCustomerPrompt();
    };
    document.addEventListener('click', (e)=>{ if(!anchor.contains(e.target)) list.style.display='none'; }, {once:true});
    return;
  }
  list.innerHTML = data.map((x,i)=>`<div class="suggest-item" data-i="${i}">
      <div><b>${x.name||'-'}</b> ¬∑ ${x.phone||''}</div>
      <div class="hint">${x.address||''}</div>
    </div>`).join('');
  list.style.display='block';
  list.onclick = (e)=>{
    const item = e.target.closest('.suggest-item'); if(!item) return;
    const o = data[+item.dataset.i]; fill(o); list.style.display='none';
  };
  document.addEventListener('click', (e)=>{ if(!anchor.contains(e.target)) list.style.display='none'; }, {once:true});
}

const searchByName = debounce(async()=>{
  const data = await fetchSuggest(nameEl.value.trim());
  showList(nameEl.parentElement, nameList, data, o=>{
    nameEl.value=o.name||''; phone.value=(o.phone||'').replace(/\D+/g,'');
    address.value=o.address||''; note.value=o.note||'';
  });
}, 100);

const searchByPhone = debounce(async()=>{
  const data = await fetchSuggest(phone.value.trim());
  showList(phone.parentElement, phoneList, data, o=>{
    nameEl.value=o.name||''; phone.value=(o.phone||'').replace(/\D+/g,'');
    address.value=o.address||''; note.value=o.note||'';
  });
}, 100);

nameEl.addEventListener('input', searchByName);
phone.addEventListener('input', searchByPhone);

/* ====== ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (POST ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Apps Script) ====== */
async function addCustomerPrompt(){
  const newCust = {
    name: nameEl.value.trim(),
    phone: phone.value.replace(/\D+/g,'').trim(),
    address: address.value.trim(),
    note: note.value.trim()
  };
  if(!newCust.name || !newCust.phone){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà"); return;
  }
  if(!confirm(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà?\n\n‡∏ä‡∏∑‡πà‡∏≠: ${newCust.name}\n‡πÄ‡∏ö‡∏≠‡∏£‡πå: ${newCust.phone}`)) return;
  try{
    const res = await fetch(GAS_BASE, { method: 'POST', body: JSON.stringify({ action:'add', customer:newCust }) });
    const r = await res.json();
    alert(r.ok ? '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢' : ('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: '+(r.message||'Unknown')));
  }catch(err){
    alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err.message);
  }
}

/* =========================
   ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ + ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ (state) + ‡πÄ‡∏°‡∏ô‡∏π
   ========================= */
const cart = new Map(); // key = item.id, value = { id,name,unit,qty,subtotal,category }

const catalog = {
  '‡∏ù‡∏£‡∏±‡πà‡∏á': [
    { id:'guava_s', name:'‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏•‡πá‡∏Å',  unit:39 },
    { id:'guava_l', name:'‡∏ù‡∏£‡∏±‡πà‡∏á‡πÉ‡∏´‡∏ç‡πà', unit:69 },
  ],
  '‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á': [
    { id:'mango',       name:'‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á',                     unit:40 },
    { id:'nm_shrimp',   name:'‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏Å‡∏∏‡πâ‡∏á‡πÅ‡∏´‡πâ‡∏á',       unit:29 },
    { id:'nm_fish',     name:'‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏õ‡∏•‡∏≤‡∏õ‡πà‡∏ô',         unit:29 },
    { id:'set_m_shr',   name:'‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á + ‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏Å‡∏∏‡πâ‡∏á‡πÅ‡∏´‡πâ‡∏á', unit:69 },
    { id:'set_m_fish',  name:'‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á + ‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏õ‡∏•‡∏≤‡∏õ‡πà‡∏ô',   unit:69 },
  ],
  '‡∏™‡πâ‡∏°': [
    { id:'or_tw_s', name:'‚Äî ‡∏™‡πâ‡∏°‡πÑ‡∏ï‡πâ‡∏´‡∏ß‡∏±‡∏ô ‚Äî', sep:true },
    { id:'or_tw_s_p', name:'‡∏™‡πâ‡∏°‡πÑ‡∏ï‡πâ‡∏´‡∏ß‡∏±‡∏ô‡πÄ‡∏•‡πá‡∏Å',  unit:49 },
    { id:'or_tw_l_p', name:'‡∏™‡πâ‡∏°‡πÑ‡∏ï‡πâ‡∏´‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏ç‡πà', unit:89 },

    { id:'or_au_s', name:'‚Äî ‡∏™‡πâ‡∏°‡∏≠‡∏≠‡∏™‡πÄ‡∏ï‡∏£‡πÄ‡∏•‡∏µ‡∏¢ ‚Äî', sep:true },
    { id:'or_au_s_p', name:'‡∏™‡πâ‡∏°‡∏≠‡∏≠‡∏™‡πÄ‡∏ï‡∏£‡πÄ‡∏•‡∏µ‡∏¢‡πÄ‡∏•‡πá‡∏Å',  unit:59 },
    { id:'or_au_l_p', name:'‡∏™‡πâ‡∏°‡∏≠‡∏≠‡∏™‡πÄ‡∏ï‡∏£‡πÄ‡∏•‡∏µ‡∏¢‡πÉ‡∏´‡∏ç‡πà', unit:99 },

    { id:'or_ch_s', name:'‚Äî ‡∏™‡πâ‡∏°‡πÄ‡∏ä‡πâ‡∏á ‚Äî', sep:true },
    { id:'or_ch_s_p', name:'‡∏™‡πâ‡∏°‡πÄ‡∏ä‡πâ‡∏á‡πÄ‡∏•‡πá‡∏Å',  unit:49 },
    { id:'or_ch_l_p', name:'‡∏™‡πâ‡∏°‡πÄ‡∏ä‡πâ‡∏á‡πÉ‡∏´‡∏ç‡πà', unit:89 },
  ],
  '‡∏Å‡∏£‡∏∞‡∏ó‡πâ‡∏≠‡∏ô': [
    { id:'santorn_mix', name:'‡∏Å‡∏£‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏ó‡∏£‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á', unit:69 },
    { id:'santorn_nm',  name:'‡∏Å‡∏£‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤‡∏´‡∏ß‡∏≤‡∏ô', unit:69 },
  ],
  // ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏£‡∏ß‡∏°: ‡πÇ‡∏õ‡∏£ 3 ‡∏Å‡∏•‡πà‡∏≠‡∏á = 100, ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏•‡∏∞ 3 = 100, ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ * 35
  '‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏£‡∏ß‡∏°': [
    { id:'mixbox', name:'‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏£‡∏ß‡∏°', unit:35, special:'mixRule' }
  ],
  '‡πÄ‡∏£‡∏ó‡∏™‡πà‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©': [
    { id:'sp_ws_guava_s_33', name:'‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏•‡πá‡∏Å',  unit:33 },
    { id:'sp_ws_guava_s_35', name:'‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏•‡πá‡∏Å (‡∏≠‡∏µ‡∏Å‡πÑ‡∏ã‡∏™‡πå)',  unit:35 },
    { id:'sp_ws_guava_l_65', name:'‡∏ù‡∏£‡∏±‡πà‡∏á‡πÉ‡∏´‡∏ç‡πà', unit:65 }
  ],
  '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ': [
    { id:'misc_custom', name:'‚Äî ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á ‚Äî', custom:true }
  ]
};

// ‡∏Å‡∏é‡∏£‡∏≤‡∏Ñ‡∏≤ "‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏£‡∏ß‡∏°"
function priceMix(q){ // 3=100 / ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏•‡∏∞ 3 = 100
  if(!q) return 0;
  const groups = Math.floor(q/3);
  const rest   = q%3;
  return groups*100 + rest*35;
}

/* ====== Modal ‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ====== */
const menuWrap = document.getElementById('menuWrap');
const menuTitle = document.getElementById('menuTitle');
const menuBody  = document.getElementById('menuBody');
const btnMenuBack = document.getElementById('btnMenuBack');
const btnMenuDelete = document.getElementById('btnMenuDelete');
const btnMenuConfirm = document.getElementById('btnMenuConfirm');

let currentCategory = null;

function openMenu(category){
  currentCategory = category;
  menuTitle.textContent = category;
  renderMenu(category);
  menuWrap.style.display = 'flex';
}

function closeMenu(){
  menuWrap.style.display = 'none';
  currentCategory = null;
}

/* ====== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ ====== */
function renderMenu(category){
  const items = catalog[category] || [];
  menuBody.innerHTML = '';

  items.forEach(it=>{
    if(it.sep){
      const sep = document.createElement('div');
      sep.textContent = it.name;
      sep.style.gridColumn = '1 / -1';
      sep.style.color = '#6b7280';
      sep.style.fontWeight = '700';
      sep.style.margin = '8px 0 4px';
      menuBody.appendChild(sep);
      return;
    }

    // ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
    const nameEl = document.createElement('div');
    nameEl.textContent = it.name + (it.unit ? ` (${it.unit}‡∏ø)` : '');
    nameEl.style.fontWeight = '600';

    // ‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
    const qtyEl = document.createElement('input');
    qtyEl.type = 'number';
    qtyEl.min = '0';
    qtyEl.placeholder = '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô';
    qtyEl.className = 'input';
    qtyEl.style.width = '100px';

    // ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    const sumEl = document.createElement('div');
    sumEl.style.textAlign = 'right';
    sumEl.style.fontWeight = '700';

    // ‡πÇ‡∏´‡∏•‡∏î qty ‡∏à‡∏≤‡∏Å cart ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
    const saved = cart.get(it.id);
    if(saved) qtyEl.value = saved.qty;

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å
    function updateSum(){
      const q = parseInt(qtyEl.value||'0',10);
      let subtotal = 0;
      if(it.special === 'mixRule'){
        subtotal = priceMix(q);
      }else if(it.custom){
        // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á priceInput ‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÉ‡∏ô _custom (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        const priceField = (qtyEl._custom && qtyEl._custom.priceInput) || null;
        const priceVal = parseInt(((priceField && priceField.value) || '0').replace(/[^\d]/g,''),10) || 0;
        subtotal = q * priceVal;
      }else{
        subtotal = q * (it.unit||0);
      }
      sumEl.textContent = q>0 ? `${subtotal}‡∏ø` : '';
    }

    // ‡∏ñ‡πâ‡∏≤ custom ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° input ‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏≤‡∏Ñ‡∏≤
    if(it.custom){
      const nameInput = document.createElement('input');
      nameInput.className = 'input';
      nameInput.placeholder = '‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π (‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á)';
      nameInput.style.gridColumn = '1 / span 1';

      const priceInput = document.createElement('input');
      priceInput.className = 'input';
      priceInput.placeholder = '‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢';
      priceInput.inputMode = 'numeric';
      priceInput.pattern = '\\d*';
      priceInput.style.width = '120px';

      // ‡πÇ‡∏´‡∏•‡∏î state
      if(saved){
        nameInput.value = saved.name || '';
        priceInput.value = saved.unit || '';
      }

      // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå: ‡∏ä‡∏∑‡πà‡∏≠ | ‡∏£‡∏≤‡∏Ñ‡∏≤ | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô | ‡∏£‡∏ß‡∏°
      nameEl.textContent = ''; // ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
      menuBody.appendChild(nameInput);
      menuBody.appendChild(priceInput);
      menuBody.appendChild(qtyEl);
      menuBody.appendChild(sumEl);

      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å accessor ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö confirm ‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡∏Å event
      qtyEl._custom = { nameInput, priceInput, item: it, sumEl, updater: updateSum };
      priceInput.addEventListener('input', updateSum);
      nameInput.addEventListener('input', updateSum);
      qtyEl.addEventListener('input', updateSum);
      updateSum(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á input ‡∏Ñ‡∏£‡∏ö
      return;
    }

    // ‡∏õ‡∏Å‡∏ï‡∏¥: ‡∏ä‡∏∑‡πà‡∏≠ | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô | ‡∏£‡∏ß‡∏°
    menuBody.appendChild(nameEl);
    menuBody.appendChild(qtyEl);
    menuBody.appendChild(sumEl);

    // ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô confirm + event
    qtyEl._item = it;
    qtyEl.addEventListener('input', updateSum);
    updateSum();
  });
}

function saveCategory(){
  const nodes = menuBody.querySelectorAll('input[type=number]');
  nodes.forEach(qtyEl=>{
    let it = qtyEl._item || (qtyEl._custom && qtyEl._custom.item);
    if(!it) return;
    const q = parseInt(qtyEl.value||'0',10);

    if(it.custom){
      const { nameInput, priceInput } = qtyEl._custom;
      const unit = parseInt((priceInput.value||'0').replace(/[^\d]/g,''),10) || 0;
      const name = (nameInput.value||'').trim() || '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á';
      const subtotal = unit * q;
      if(q>0){
        cart.set(it.id, { id: it.id, name, unit, qty: q, subtotal, category: currentCategory });
      }else{
        cart.delete(it.id);
      }
      return;
    }

    if(it.special === 'mixRule'){
      if(q>0){
        cart.set(it.id, { id: it.id, name: it.name, unit: it.unit, qty: q, subtotal: priceMix(q), category: currentCategory });
      }else{
        cart.delete(it.id);
      }
      return;
    }

    // ‡∏õ‡∏Å‡∏ï‡∏¥
    if(q>0){
      cart.set(it.id, { id: it.id, name: it.name, unit: it.unit, qty: q, subtotal: q*it.unit, category: currentCategory });
    }else{
      cart.delete(it.id);
    }
  });
}

btnMenuConfirm.onclick = ()=>{ saveCategory(); closeMenu(); };
btnMenuBack.onclick    = ()=>{ saveCategory(); closeMenu(); };
btnMenuDelete.onclick  = ()=>{
  for(const [k,v] of cart.entries()){
    if(v.category === currentCategory) cart.delete(k);
  }
  closeMenu();
};

/* ====== SUMMARY ====== */
const modalWrap = document.getElementById('modalWrap');
const summaryText = document.getElementById('summaryText');

function summarize(){
  let d = '';
  if (dateHidden.value) { d = toDDMMYYYY(new Date(dateHidden.value)); } else { d = toDDMMYYYY(new Date()); }
  let lines = [];
  let sum = 0;
  for(const v of cart.values()){
    lines.push(`„Éª${v.name} √ó${v.qty} (${v.subtotal}‡∏ø)`);
    sum += v.subtotal;
  }
  const shippingVal = parseInt((shipping.value||'0').replace(/[^\d]/g,''),10) || 0;
  const grand = sum + shippingVal;

  const txt =
`${d}
‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ñ‡∏∏‡∏ì ${nameEl.value||'-'}
(${phone.value||'-'})

‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
${lines.length?lines.join('\n'):'„Éª(‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)'}

‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á ${shippingVal}‡∏ø
‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${grand}‡∏ø

üìç ${address.value||'-'}`;

  summaryText.textContent = txt;
  modalWrap.style.display='flex';
}

function closeModal(){ modalWrap.style.display='none'; }

async function copySummary(){
  try{
    await navigator.clipboard.writeText(summaryText.textContent||'');
    alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
  }catch{ alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ'); }
}

function printSummary(){
  const w = window.open('','_blank');
  w.document.write(`<pre style="font-family:system-ui;white-space:pre-wrap">${summaryText.textContent}</pre>`);
  w.document.close(); w.focus(); w.print();
}

function clearAll(){
  nameEl.value=''; phone.value=''; address.value=''; shipping.value=''; note.value='';
  cart.clear();
}
</script>
</body>
</html>
