<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fruit Order</title>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f3f4f6;margin:0;padding:16px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
  .box{background:#e3f0e7;border-radius:14px;padding:14px}
  .input{width:100%;padding:12px 14px;border:1px solid #cfe1d6;border-radius:12px;font-size:16px;background:#fff}
  .pill{padding:14px 18px;border-radius:999px;background:#1b7f46;color:#fff;font-weight:700;text-align:center;display:inline-block}
  .suggest{position:relative}
  .suggest-list{position:absolute;z-index:20;top:100%;left:0;right:0;background:#fff;border:1px solid #d1d5db;border-radius:10px;max-height:220px;overflow:auto;box-shadow:0 8px 24px rgba(0,0,0,.08)}
  .suggest-item{padding:10px 12px;cursor:pointer}
  .suggest-item:hover{background:#f3f4f6}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin:18px 0}
  .card{background:#79a88c;border-radius:22px;padding:26px;text-align:center;font-size:28px;color:#14221a;font-weight:800;cursor:pointer}
  .footer{position:fixed;left:0;right:0;bottom:0;background:#e5e5e5;padding:14px 16px;display:flex;gap:14px;justify-content:center}
  .btn{border:none;border-radius:18px;padding:14px 20px;font-size:18px;font-weight:700;cursor:pointer}
  .btn-primary{background:#67b57f;color:#0b381f}
  .btn-danger{background:#e45a52;color:#fff}

  /* modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.3);display:none;align-items:center;justify-content:center;z-index:50}
  .modal{background:#fff;border-radius:16px;max-width:560px;width:92%;padding:16px 16px 8px}
  .modal pre{white-space:pre-wrap;background:#f7f7f7;border:1px solid #e5e7eb;border-radius:10px;padding:10px;max-height:50vh;overflow:auto}
  .modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}
</style>
</head>
<body>
  <!-- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà -->
  <div style="margin-bottom:14px">
    <button id="btnDate" class="pill">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</button>
    <input id="dateHidden" type="date" style="display:none" />
    <span id="dateText" style="margin-left:12px;font-weight:700"></span>
  </div>

  <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ -->
  <div class="box">
    <div class="row">
      <div class="suggest">
        <input id="name" class="input" placeholder="‡∏ä‡∏∑‡πà‡∏≠" autocomplete="off" />
        <div id="nameList" class="suggest-list" style="display:none"></div>
      </div>
      <div class="suggest">
        <input id="phone" class="input" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå" autocomplete="off" inputmode="numeric" pattern="\d*" />
        <div id="phoneList" class="suggest-list" style="display:none"></div>
      </div>
    </div>
    <div class="row">
      <input id="address" class="input" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á" />
      <input id="shipping" class="input" placeholder="‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á" inputmode="numeric" pattern="\d*" />
    </div>
    <div class="row">
      <input id="note" class="input" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏" />
      <div></div>
    </div>
  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á; ‡∏ï‡πà‡∏≠ logic ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á) -->
  <div class="grid">
    <div class="card" onclick="openMenu('‡∏ù‡∏£‡∏±‡πà‡∏á')">‡∏ù‡∏£‡∏±‡πà‡∏á</div>
    <div class="card" onclick="openMenu('‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á')">‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á</div>
    <div class="card" onclick="openMenu('‡∏™‡πâ‡∏°')">‡∏™‡πâ‡∏°</div>
    <div class="card" onclick="openMenu('‡∏Å‡∏£‡∏∞‡∏ó‡πâ‡∏≠‡∏ô')">‡∏Å‡∏£‡∏∞‡∏ó‡πâ‡∏≠‡∏ô</div>
    <div class="card" onclick="openMenu('‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏£‡∏ß‡∏°')">‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏£‡∏ß‡∏°</div>
    <div class="card" onclick="openMenu('‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡πà‡∏á')">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡πà‡∏á</div>
    <div class="card" style="grid-column:2/3" onclick="openMenu('‡∏≠‡∏∑‡πà‡∏ô ‡πÜ')">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</div>
  </div>

  <div class="footer">
    <button class="btn btn-primary" onclick="summarize()">‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
    <button class="btn btn-danger" onclick="clearAll()">‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
  </div>

  <!-- Modal Summary -->
  <div id="modalWrap" class="modal-backdrop">
    <div class="modal">
      <h3 style="margin:0 0 8px">‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h3>
      <pre id="summaryText"></pre>
      <div class="modal-actions">
        <button class="btn" onclick="copySummary()">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
        <button class="btn btn-primary" onclick="printSummary()">‡∏û‡∏¥‡∏°‡∏û‡πå</button>
        <button class="btn btn-danger" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </div>
  </div>
  
<!-- Modal Menu (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤) -->
<div id="menuWrap" class="modal-backdrop">
  <div class="modal">
    <h3 id="menuTitle" style="margin:0 0 8px">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
    <div id="menuBody" style="display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center"></div>
    <div class="modal-actions" style="margin-top:12px">
      <button class="btn" id="btnMenuBack">‡∏Å‡∏•‡∏±‡∏ö</button>
      <button class="btn btn-danger" id="btnMenuDelete">‡∏•‡∏ö</button>
      <button class="btn btn-primary" id="btnMenuConfirm">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
    </div>
  </div>
</div>

<script>
/*** ‚Üê ‡πÉ‡∏™‡πà URL ‡∏à‡∏≤‡∏Å Apps Script Web App ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ***/
const GAS_BASE = 'https://script.google.com/macros/s/PASTE-YOUR-EXEC-URL/exec';
/***********************************************/

const GAS_SEARCH = (q)=> `${GAS_BASE}?action=search&query=${encodeURIComponent(q)}`;

// ---- DATE (DD/MM/YYYY) ----
const btnDate = document.getElementById('btnDate');
const dateHidden = document.getElementById('dateHidden');
const dateText = document.getElementById('dateText');
const toDDMMYYYY = d => {
  const pad = n => String(n).padStart(2,'0');
  return `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()}`;
};
(function setToday(){ const d=new Date(); dateHidden.valueAsDate=d; dateText.textContent=toDDMMYYYY(d);}());
btnDate.addEventListener('click', ()=> dateHidden.showPicker ? dateHidden.showPicker() : dateHidden.focus());
dateHidden.addEventListener('change', ()=> dateText.textContent = toDDMMYYYY(new Date(dateHidden.value)));

// ---- NUMERIC ONLY ----
const phone = document.getElementById('phone');
const shipping = document.getElementById('shipping');
phone.oninput = ()=> phone.value = phone.value.replace(/[^\d]/g,'');
shipping.oninput = ()=> shipping.value = shipping.value.replace(/[^\d]/g,'');

// ---- SEARCH + ADD CUSTOMER ----
const nameEl = document.getElementById('name');
const nameList = document.getElementById('nameList');
const phoneList = document.getElementById('phoneList');
const address = document.getElementById('address');
const note = document.getElementById('note');

let debounceT;
const debounce = (fn,ms)=> (...a)=>{ clearTimeout(debounceT); debounceT=setTimeout(()=>fn(...a),ms); };

async function fetchSuggest(q){
  if(!q || q.length<2) return [];
  try{
    const res = await fetch(GAS_SEARCH(q));
    if(!res.ok) return [];
    return await res.json();
  }catch(e){ return []; }
}
function showList(anchor,list,data,fill){
  if(!data.length){
    list.innerHTML = `
      <div class="suggest-item" style="color:#666">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
      <div class="suggest-item" style="color:#0b381f;font-weight:700">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</div>`;
    list.style.display='block';
    list.onclick = async (e)=>{
      if(e.target.closest('.suggest-item') && e.target.textContent.includes('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤')) addCustomerPrompt();
    };
    document.addEventListener('click', (e)=>{ if(!anchor.contains(e.target)) list.style.display='none'; }, {once:true});
    return;
  }
  list.innerHTML = data.map((x,i)=>`<div class="suggest-item" data-i="${i}">
      <div><b>${x.name||'-'}</b> ¬∑ ${x.phone||''}</div>
      <div style="color:#6b7280">${x.address||''}</div>
    </div>`).join('');
  list.style.display='block';
  list.onclick = (e)=>{
    const item = e.target.closest('.suggest-item'); if(!item) return;
    const o = data[+item.dataset.i]; fill(o); list.style.display='none';
  };
  document.addEventListener('click', (e)=>{ if(!anchor.contains(e.target)) list.style.display='none'; }, {once:true});
}
const searchByName = debounce(async()=>{
  const data = await fetchSuggest(nameEl.value.trim());
  showList(nameEl.parentElement, nameList, data, o=>{
    nameEl.value=o.name||''; phone.value=(o.phone||'').replace(/[^\d]/g,'');
    address.value=o.address||''; note.value=o.note||'';
  });
}, 220);
const searchByPhone = debounce(async()=>{
  const data = await fetchSuggest(phone.value.trim());
  showList(phone.parentElement, phoneList, data, o=>{
    nameEl.value=o.name||''; phone.value=(o.phone||'').replace(/[^\d]/g,'');
    address.value=o.address||''; note.value=o.note||'';
  });
}, 220);
nameEl.addEventListener('input', searchByName);
phone.addEventListener('input', searchByPhone);

async function addCustomerPrompt(){
  const newCust = {
    name: nameEl.value.trim(),
    phone: phone.value.trim(),
    address: address.value.trim(),
    note: note.value.trim()
  };
  if(!newCust.name || !newCust.phone){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà"); return;
  }
  if(!confirm(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà?\n\n‡∏ä‡∏∑‡πà‡∏≠: ${newCust.name}\n‡πÄ‡∏ö‡∏≠‡∏£‡πå: ${newCust.phone}`)) return;
  const res = await fetch(GAS_BASE, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ action:'add', customer:newCust })
  });
  const r = await res.json();
  alert(r.ok ? '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢' : ('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: '+(r.message||'Unknown')));
}

// ---- MENU placeholder ----
function openMenu(title){ alert('‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π: '+title+' (‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏™‡πÄ‡∏õ‡πá‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ)'); }

// ---- SUMMARY (modal with 3 buttons) ----
const modalWrap = document.getElementById('modalWrap');
const summaryText = document.getElementById('summaryText');

function summarize(){
  const d = dateText.textContent || toDDMMYYYY(new Date());
  const txt =
`${d}
‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ñ‡∏∏‡∏ì : ${nameEl.value||'-'}
‡πÇ‡∏ó‡∏£ : ${phone.value||'-'}
‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
„Éª(‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á) ‡∏ù‡∏£‡∏±‡πà‡∏á‡πÉ‡∏´‡∏ç‡πà √ó 2 (138‡∏ø)

‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á : ${shipping.value||'0'}‡∏ø
‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î : _____‡∏ø

üìç${address.value||'-'}
‚ÄºÔ∏è${note.value||''}`;
  summaryText.textContent = txt;
  modalWrap.style.display='flex';
}
function closeModal(){ modalWrap.style.display='none'; }
async function copySummary(){
  await navigator.clipboard.writeText(summaryText.textContent||'');
  alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
}
function printSummary(){
  const w = window.open('','_blank');
  w.document.write(`<pre style="font-family:system-ui;white-space:pre-wrap">${summaryText.textContent}</pre>`);
  w.document.close(); w.focus(); w.print();
}
function clearAll(){
  nameEl.value=''; phone.value=''; address.value=''; shipping.value=''; note.value='';
  // TODO: ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô state ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡πâ‡∏ß‡∏¢
}
</script>
</body>
</html>
